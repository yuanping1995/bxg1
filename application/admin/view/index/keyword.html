{include file="/public/header"}
<!--<link rel="stylesheet" type="text/css" href="{$Think.__APPROOT__}/static/admin/css/webuploader.css?v=0.1.5" media="all">-->
<!--<script type="text/javascript" src="{$Think.__APPROOT__}/static/admin/js/jquery.min.js"></script>-->
<body>
    <div class="container-fluid larry-wrapper">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12">
                <!--头部搜索-->
                <section class="panel panel-padding">
                    <form class="layui-form" action="/admin/index/keywordsfind.html">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input class="layui-input" name="keyword" placeholder="关键字">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <button lay-submit class="layui-btn" lay-filter="search">查找</button>
                            </div>
                        </div>
                    </form>
                </section>

                <!--列表-->
                <section class="panel panel-padding">
                    <div class="group-button">
                        <!--<button class="layui-btn layui-btn-small layui-btn-danger ajax-all" data-name="checkbox" data-params='{"url": "/admin/index/delBrand.html","data":"id=1&name=ni&checkbox=6,9,0&va=23"}'>
                            <i class="iconfont">&#xe626;</i> 删除
                        </button>-->
                        <button class="layui-btn layui-btn-small modal-catch" data-params='{"content": ".add-subcat", "title": "添加关键字","type":"1","area":"600,auto"}'>
                            <i class="iconfont">&#xe649;</i> 添加
                        </button>
                    </div>
                    <div id="list" class="layui-form"></div>

                    <div class="text-right" id="page"></div>
                </section>
            </div>
        </div>
    </div>

    <div class="add-subcat">
        <form id="form1" class="layui-form layui-form-pane" action="/admin/index/handlekeyword.html">
			<div class="layui-form-item">
				<label class="layui-form-label">选择分类</label>
				<div class="layui-input-inline">
					<select lay-filter="yi" id="yi" name="onelevel" required jq-verify="required">
						<option value="">选择分类</option>
						{foreach name="level" item="value"}
						<option value="{$value.id}">{$value.pname}</option>
						{/foreach}
					</select>
				</div>
				<div class="layui-input-inline">
					<select lay-filter="er" id="er" name="twolevel">
						<option value="">请先选择前提</option>
						{foreach name="level" item="value"}
						{foreach name="$value.child" item="val"}
						{if condition="($val.pid eq $value.id)"}
						<option value="{$val.id}">{$val.pname}</option>
						{/if}
						{/foreach}
						{/foreach}
					</select>
				</div>
				<div class="layui-input-inline">
					<select lay-filter="san" name="threelevel" id="san" >
						<option value="">请先选择前提</option>
						{foreach name="level" item="value"}
						{foreach name="$value.child" item="val"}
						{foreach name="$val.child" item="v"}
						{if condition="($v.pid eq $val.id)&&($val.pid eq $value.id)"}
						<option value="{$v.id}">{$v.pname}</option>
						{/if}
						{/foreach}
						{/foreach}
						{/foreach}	
					</select>
			
				</div>
				<label class="layui-form-label" id="getnewlevel">刷新分类</label>
			</div>
            <div class="layui-form-item">
                <label class="layui-form-label">关键字</label>
                <div class="layui-input-block">
                    <input type="text" name="keywords" required jq-verify="required" jq-error="请输入关键字" placeholder="请输入关键字" autocomplete="off" class="layui-input" id="keywords">
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn" jq-submit jq-filter="submit">立即提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>

</body>
<script id="list-tpl" type="text/html" data-params='{"url":"/admin/index/getkeyword/","pageid":"#page"}'>
    <table id="example" class="layui-table lay-even">
        <thead>
            <tr>
                <th width="30"><input type="checkbox" id="checkall" data-name="checkbox" lay-filter="check" lay-skin="primary"></th>
                <th width="60">一级分类</th>
                <th width="60">二级分类</th>
                <th width="60">三级分类</th>
                <th width="70">关键字</th>
                <th width="142">操作</th>
            </tr>
        </thead>
        <tbody>
            {{# layui.each(d.list, function(index, item){ }}
            <tr>
                <td><input type="checkbox" name="checkbox" value="{{ item.id}}" lay-skin="primary"></td>
                <td>{{item.onepname}}</td>
                <td>{{item.twopname}}</td>
                <td>{{item.threepname}}</td>
                <td>{{ item.keywords}}</td>
                <td>
                    <button class="layui-btn layui-btn-mini modal-catch" data-params='{"content": ".add-subcat","area":"600,auto", "title": "编辑关键字(温馨提示:如需改动分类，请先刷新分类)","type":"1","data":"id={{item.id}}&onelevel={{item.onelevel}}&twolevel={{item.twolevel}}&threelevel={{item.threelevel}}&keywords={{item.keywords}}"}'>
                        <i class="iconfont">&#xe653;</i>编辑
                    </button>
                   <!-- <button class="layui-btn layui-btn-mini layui-btn-danger ajax" data-params='{"url": "/admin/index/delkeyword.html","data":"id={{item.id}}"}'>
                        <i class="iconfont">&#xe626;</i>删除
                    </button>-->
                </td>
            </tr>
            {{# }); }}
        </tbody>

    </table>
</script>
<script src="{$Think.__APPROOT__}/static/admin/js/layui/layui.js"></script>
{include file="/public/version"}
<script>
layui.use('list',function(){
    	    layui.upload({
			elem: '.layui-upload-file',
			url: "/Admin/Upload/brandimg",
			before: function(input) {
				box = $(input).parent('form').parent('div').parent('.layui-input-block');
				if(box.next('div').length > 0) {
					box.next('div').html('<div class="imgbox"><p>上传中...</p></div>');
				} else {
					box.after('<div class="layui-input-block"><div class="imgbox"><p>上传中...</p></div></div>');
				}
			},
			success: function(res) {
				if(res.status == 200) {
					box.next('div').find('div.imgbox').html('<img src="' + res.url + '" alt="..." class="img-thumbnail">');
					$('#url').val(res.url);
					form.check(box.find('input[type=hidden]'));
					alert(1);
				} else {
					box.next('div').find('p').html('上传失败...')
				}
			}
		});
    });
    //判断品牌是否存在
      $('#ppname').blur(function(){
    	var ppname=$(this).val();
    	var selectd=$('#One_level').val();
    	 if(selectd==""){
	           	   $('#err').html("请先选择分类");
	           	   $('#err').css("display","block");
           	   	   $('#ppname').val("");
           	   }else{
           	   	  $.ajax({
		             type: "post",
		             url: "/admin/index/ajaxbrand",
		             data: {ppname:ppname,selectd:selectd},
		             success:function(data){
		             	if(data==2){
		             	  $('#err').css("display","none");	
		             	}else{
		                 //显示
		                    $('#err').css("display","block");
		                     $('#ppname').val("");
		                    
		             	}
		             }
               });
           	   }
    	
             
    });
      $('#ppname').blur(function(){
    	var ppname=$(this).val();
    	var selectd=$('#One_level').val();
    	 if(selectd==""){
	           	   $('#err').html("请先选择分类");
	           	   $('#err').css("display","block");
           	   	   $('#ppname').val("");
           	   }else{
           	   	  $.ajax({
		             type: "post",
		             url: "/admin/index/ajaxbrand",
		             data: {ppname:ppname,selectd:selectd},
		             success:function(data){
		             	if(data==2){
		             	  $('#err').css("display","none");	
		             	}else{
		                 //显示
		                    $('#err').css("display","block");
		                     $('#ppname').val("");
		                    
		             	}
		             }
               });
           	   }
    	
             
    });
$('#seller_cx').click(function(){

		
			 $.ajax({  
                type:'post',  
                url:'/admin/index/getsellername.html',  
                dataType:'json',  
                data:{sellername:$('#seller_name').val()},  
               success:function(json){ 
					$('#tipaaa').html('');			   
                    $('#tipaaa').append(json.str);
                }  
        });
				
});

    	layui.use(['layedit', 'form', 'upload', 'tags', 'laydate'], function() {
    		var form = layui.form(),
			laydate = layui.laydate,
			$ = layui.jquery,
			tags = layui.tags,
			upload = layui.upload,
			layedit = layui.layedit;
		var laydate = layui.laydate;
		
	$('#getnewpinpai').click(function(){
			 $.ajax({  
                type:'post',  
                url:'/admin/index/getnewpinpai.html',  
                dataType:'json', 
				data:{onelevel:$('#yi option:selected').val()},  
               success:function(data){ 
					$('#brand').html('<option value="">选择品牌</option>');
					$.each(data, function(no, items) {
						$('#brand').append('<option value="' + items.brand_id + '">' + items.ppname + '</option>');
					});
					form.render();
                }  
        });			
});
		$('#getnewlevel').click(function(){
			 $.ajax({  
                type:'post',  
                url:'/admin/index/getlevelshuaxin.html',  
                dataType:'json',  
               success:function(data){ 
					$('#yi').html('<option value="">选择分类</option>');
					$('#er').html('<option value="">请先选择分类</option>');
					$('#san').html('<option value="">请先选择分类</option>');
					$.each(data, function(no, items) {
						$('#yi').append('<option value="' + items.id + '">' + items.pname + '</option>');
					});
					form.render();
                }  
        });			
});
		$('#getnewguigeone').click(function(){
			 $.ajax({  
                type:'post',  
                url:'/admin/index/getlevelshuaxin.html',  
                dataType:'json',  
               success:function(data){ 
					$('#spec_type').html('<option value="">选择分类</option>');
					$.each(data, function(no, items) {
						$('#spec_type').append('<option value="' + items.id + '">' + items.pname + '</option>');
					});
					form.render();
                }  
        });			
});
			form.on('select(yi)', function(data) {
				
				var url = "/admin/index/liandong/id/"+data.value;
				$.get(url, function(data, status) {
				$('#er').html('<option value="">子类目</option>');
				$('#san').html('<option value="">请选择子类</option>');
				$.each(data, function(no, items) {
					console.log(items);
					$('#er').append('<option value="' + items.id + '">' + items.pname + '</option>');
				});
				form.render();
				});
			});
			form.on('select(er)', function(data) {
							var url = "/admin/index/liandong/id/"+data.value;
							$.get(url, function(data, status) {
							$('#san').html('<option value="">请选择子类</option>');
							$.each(data, function(no, items) {
								console.log(items);
								$('#san').append('<option value="' + items.id + '">' + items.pname + '</option>');
							});
							form.render();
							});
				});
				
				form.on('select(guige)', function(data) {
					var url = "/admin/index/getShopspec/id/"+data.value;
							$.get(url, function(data, status) {
							$('#geugecontent').html('');
							
							$.each(data, function(no, items) {
//								console.log(items);
								var strguige =  '<tr>'+'<td>'+no+'</td>'+'<td><div  layui-form-item"><div class="layui-input-block">';
								$.each(items, function(no1, items1) {
								strguige += '<input type="checkbox" lay-filter="guigexuanze" guigename="'+no+'" myid="'+items1.id+'" sid="'+items1.spec_id+'" title="'+items1.item+'">';
						
							});
							 strguige += '</div> </div></td>'+'</tr>';
								$('#geugecontent').append(strguige);
							});
								$("#zuhe").html('');
								$("#neirong").html('');
							form.render();
							});
			});
			guanliani=0;
				form.on('checkbox(guigexuanze)', function(data){
				
				
				if(data.elem.checked==false)
					{
						$("#neirong").find('input[value="'+$(data.elem).attr('myid')+'"]').remove();
						$("#bangding").find('div[name='+$(data.elem).attr('myid')+']').remove();
					}else{
						var str = '<input type="hidden" name="spec_arr['+$(data.elem).attr('sid')+'][]" value="'+$(data.elem).attr('myid')+'" />';
						$('#neirong').append(str);
						var str1 ='<div name="'+$(data.elem).attr('myid')+'" class="layui-input-inline"><select lay-filter="guanlian" name="guanlian['+$(data.elem).attr('myid')+']"><option value="">'+$(data.elem).attr('title')+'不关联图片</option>';
						var i=1;
						str1 +='<option value="">'+$(data.elem).attr('title')+'不关联图片</option>';
						$('#goodsimg').find('input[type=hidden]').each(function(){
						str1 +='<option value="src'+$(this).val()+'">'+$(data.elem).attr('title')+'  =>  关联图'+i+'</option>';
						i++;
					  });
						str1 +='</select></div>';
						$("#bangding").append(str1);
						form.render();

						
					}
			   value='';
				$("#neirong input[type='hidden']").each(function(){
				//alert($(this).val());
				value += $(this).attr('name')+'='+$(this).val()+'&';
	
				}); 
				value += 'jiage='+$('#jiajiage').val()+'&'+'kucun='+ $('#kukucun').val();
				 $.ajax({  
                type:'post',  
                url:'/admin/index/ajaxGetSpecInput.html',  
               // dataType:'json',  
                data:value,  
                success:function(data){  
					$("#zuhe").html(data);

					
                }  
					});  
				
			    });
 });
  $('#seller_id').blur(function(){
    	var seller_id=$(this).val();
    	  $.ajax({
             type: "post",
             url: "/admin/index/ajaxseller",
             data: {seller_id:seller_id},
             success:function(data){
             	if(data==2){
                 $('#err').css("display","block");	
             	}else{
                 $('#err').css("display","none");	
             	}
             }
          });
             
    });
</script>
<script type="text/javascript">
  var _paq = _paq || [];
  /*
     统计
  */
  _paq.push(['trackPageView']);
  (function() {
    var u="http://m.bxgogo.com/";
    _paq.push(['setTrackerUrl', u+'count.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'/static/js/tongji.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

</html>